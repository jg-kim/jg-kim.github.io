{"componentChunkName":"component---src-templates-blog-post-js","path":"/yarn-berry/","result":{"data":{"site":{"siteMetadata":{"title":"JgKim Log"}},"markdownRemark":{"id":"ed576180-80f7-5f41-9976-9b817c399708","excerpt":"yarn? npm(node package manager)의 단점을 보안하고자 페이스북에서 인 yarn을 발표했다. yarn은 npm 기반으로 설계되었으나 설치 프로세스의 속도를 높이기 위해 작업을 병렬화하여 개선했다. 그외 안정성 항샹을 위한 lock file…","html":"<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/06efbc77014b616f012ad2678535c522/821da/yarn.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 51.26582278481012%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLUlEQVR42mOwnnsCGdnMPWE776TtvJNo4lgRA6aQ4Yyj+tOPWs45bkO8Zpu5JyznHLecc7x0142mg3ecFp4ym33ceh5ICix+wgq/ZvPZx7fffv3zz9/nn39effXZdfFpi9nHreaecF50yn7+Sbt5IFOwaLadd8J45rGkDZf////feuhu/f7b////7z9+v37/7Yb9t2effbz00rO6/bddFp5G1o+iOX3zlZ9//jkvOJW77dq/f/96j92fdurh5JMPC7ZfbzxwJ2/7tYDl58xnI8ICJcAs55zYcvPVoQfvTj75cO7ZR/fFZ7qO3nNffNp45jHTWcfMZ4N8ji/ArOeeaNh/u/PIPZdFp8xnH3daeAoiZTMPTBKMKv3pR3SnHbGcgzCOhHi2m3fSjrhEAgCX7l2J8pKWtQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"yarn\" title=\"yarn\" src=\"/static/06efbc77014b616f012ad2678535c522/f058b/yarn.png\" srcset=\"/static/06efbc77014b616f012ad2678535c522/c26ae/yarn.png 158w,\n/static/06efbc77014b616f012ad2678535c522/6bdcf/yarn.png 315w,\n/static/06efbc77014b616f012ad2678535c522/f058b/yarn.png 630w,\n/static/06efbc77014b616f012ad2678535c522/40601/yarn.png 945w,\n/static/06efbc77014b616f012ad2678535c522/78612/yarn.png 1260w,\n/static/06efbc77014b616f012ad2678535c522/821da/yarn.png 2200w\" sizes=\"(max-width: 630px) 100vw, 630px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<h1>yarn?</h1>\n<p>npm(node package manager)의 단점을 보안하고자 페이스북에서 <code class=\"language-text\">Yet Another Resource Negotiator</code>인 yarn을 발표했다. yarn은 npm 기반으로 설계되었으나 설치 프로세스의 속도를 높이기 위해 작업을 병렬화하여 개선했다.</p>\n<blockquote>\n<p>그외 안정성 항샹을 위한 lock file 도입을 하였으나 추후 npm에서도 추가됨</p>\n</blockquote>\n<p>이후 2020년부터 1.x 버전을 유지보수 모드로 전환하며 <strong>yarn classic</strong>으로 이름을 변경했다.\n그리고 2.x 버전부터는 <strong>yarn berry</strong>로 개발과 개선을 이뤄지고 있고 현재는 3.3 버전까지 진행되었다</p>\n<h2>NPM과 yarn v1(classic)의 문제점</h2>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/67224ef1f47a40bdcfdd84d0723d783b/00d43/node_modules.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 41.77215189873418%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJUlEQVR42o3P7U+CUBTH8f7//6U3QQtDYfWiWTrzYVNZNEStjGzEg4A8fRuQTHOu7qvfObv3c885A8jznDwvE8Y6oq3btJ8sbkYm7ckSuW/SfDR40F7RFh80ujrNnk5Pm1O9r4zinO3AAttmMNAmDLvndAyfwcLhTrcZLl06hsNFf4WxDpi8bRAGFtpqU0MH4H4jDr9wrXGZvTDmerQq8yZK6lzcLXIUp+wPdADuoz8VTphw+2yXlRPEKGOrzGmWo04sgj3waOVdI8uy+jfqlOOGMa3xew0WeHgK/N3cRhGe7+N5HkEQVOtHKcr08yS4O0cTzudzLkURURQRBIGWomDOZtiuj3Q/rcA0+z/4slwiyzINqcGVJKGqKqZpkiQxvu//OeE3X6lhvXR4gf0AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"node modules\" title=\"node modules\" src=\"/static/67224ef1f47a40bdcfdd84d0723d783b/f058b/node_modules.png\" srcset=\"/static/67224ef1f47a40bdcfdd84d0723d783b/c26ae/node_modules.png 158w,\n/static/67224ef1f47a40bdcfdd84d0723d783b/6bdcf/node_modules.png 315w,\n/static/67224ef1f47a40bdcfdd84d0723d783b/f058b/node_modules.png 630w,\n/static/67224ef1f47a40bdcfdd84d0723d783b/40601/node_modules.png 945w,\n/static/67224ef1f47a40bdcfdd84d0723d783b/00d43/node_modules.png 1000w\" sizes=\"(max-width: 630px) 100vw, 630px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>의존성 관리를 위해 node_modules폴더를 이용하는 것이 특징인데, 이러한 방식은 의존성 검색은 비효율적으로 동작한다</p>\n<p>라이브러리를 찾기 위해 순회하는 디렉터리 목록을 확인하려 할 때 node의 <code class=\"language-text\">require.resolve.paths</code>함수를 이용할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Welcome to Node.js v14.21.1.\nType \".help\" for more information.\n> require.resolve.paths('react')\n[\n  'C:\\\\Users\\\\jgkimm\\\\project\\\\ngm-execution-layer\\\\repl\\\\node_modules',\n  'C:\\\\Users\\\\jgkimm\\\\project\\\\ngm-execution-layer\\\\node_modules',\n  'C:\\\\Users\\\\jgkimm\\\\project\\\\node_modules',\n  'C:\\\\Users\\\\jgkimm\\\\node_modules',\n  'C:\\\\Users\\\\node_modules',\n  'C:\\\\node_modules',\n  'C:\\\\Users\\\\jgkimm\\\\.node_modules',\n  'C:\\\\Users\\\\jgkimm\\\\.node_libraries',\n  'C:\\\\Program Files\\\\nodejs\\\\lib\\\\node',\n  'C:\\\\Users\\\\jgkimm\\\\.node_modules',\n  'C:\\\\Users\\\\jgkimm\\\\.node_libraries',\n  'C:\\\\Program Files\\\\nodejs\\\\lib\\\\node'\n]</code></pre></div>\n<p>목록에서 확인한 것처럼 NPM은 패키지를 찾기 위해 상위 node_modules를 계속해서 탐색해기 때문에 많은 비용의 I/O작업을 반복적으로 진행하게 된다</p>\n<h2>Plug n play</h2>\n<p>yarn berry의 pnp는 node_modules를 해결하기 위한 전략이다. node_modules를 생성하는 대신 모든 패키지는 <code class=\"language-text\">.yarn/cache</code>폴더 내부에 zip 파일로 저장된다. 그러므로 디스크 공간을 적게 차지하고 파일 수가 많이 생성되지 않기 때문에 git으로 의존성 파일을 관리할 수 있다.\n의존성 파일을 git으로 관리하기 때문에 모든 환경에서 동일한 버전으로 관리가 쉽게 가능하기 때문에 zero-intall이 가능해진다</p>\n<h2>install (yarn berry)</h2>\n<p>yarn classic과 다르게 현재는 corepack으로 설치를 진행한다</p>\n<ol>\n<li>corepack 설치\n<ul>\n<li>Node >= 16.10의 경우 corepack이 내장되어 있기 때문에 enable만 하면 corepack 사용이 가능함</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">corepack enable</code></pre></div>\n<ul>\n<li>Node &#x3C; 16.10의 경우 corepack 설치가 필요</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm i -g corepack</code></pre></div>\n</li>\n<li>yarn berry 설치\n<ul>\n<li>Node.js ^16.17 or >=18.6</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">corepack prepare yarn@stable --activate</code></pre></div>\n<ul>\n<li>Node.js &#x3C;16.17 or &#x3C;18.6</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">corepack prepare yarn@&lt;version> --activate</code></pre></div>\n</li>\n</ol>\n<blockquote>\n<p>yarn v1(classic)에서 업데이트의 경우 <code class=\"language-text\">yarn set version stable</code> 실행으로 가능하다</p>\n</blockquote>\n<h2>vscode 설정</h2>\n<p>yarn berry의 경우 의존성 파일을 zip 파일로 관리하기 때문에 go-to-definition 기능을 사용하기 위해서는 추가 extension이 필요하다.</p>\n<ol>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=arcanis.vscode-zipfs\">ZipFs</a> 설치</li>\n</ol>\n<p>그리고 vscode의 sdks를 설치한다.</p>\n<ol start=\"2\">\n<li><code class=\"language-text\">yarn dlx @yarnpkg/sdks vscode</code></li>\n</ol>\n<p>설치가 완료되면 vscode 워크스페이스의 typescript의 버전을 설정을 <code class=\"language-text\">.yarn/sdks/typescript/lib</code>로 설정한다(자동으로 우측 하단에 allow관련 컨펌 토스트 알림이 발생).</p>\n<h2>마치며</h2>\n<p>CI에서 docker에 환경을 설정하고 의존성 파일을 내려받는 과정에 많은 시간이 걸렸는데, zero-install로 인한 시간 단축만으로 만족도가 높다. 물론 설정하는 과정과 기존 node_modules의 경로를 직접 참고(tsconfig의 paths)하는 부분이 있었는데 yarn berry를 적용하고 어떤 방식으로 수정을 진행해야 할지는 차차 찾아봐야 할 일이다</p>\n<h2>참조문서</h2>\n<p><a href=\"https://toss.tech/article/node-modules-and-yarn-berry\">https://toss.tech/article/node-modules-and-yarn-berry</a></p>\n<p><a href=\"https://yceffort.kr/2022/05/npm-vs-yarn-vs-pnpm\">https://yceffort.kr/2022/05/npm-vs-yarn-vs-pnpm</a></p>\n<p><a href=\"https://helloinyong.tistory.com/341\">https://helloinyong.tistory.com/341</a></p>","frontmatter":{"title":"Yarn berry 사용하기","date":"December 22, 2022","description":null}},"previous":{"fields":{"slug":"/new-beginnings/"},"frontmatter":{"title":"New Beginnings"}},"next":{"fields":{"slug":"/Typescript-유틸리티-타입-(particial,pick,omit)/"},"frontmatter":{"title":"Typescript 유틸리티 타입"}}},"pageContext":{"id":"ed576180-80f7-5f41-9976-9b817c399708","previousPostId":"634955a8-89c9-54bd-8587-0354bb59feda","nextPostId":"84447be7-5fda-575b-8c38-27ea6b2e4c08"}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}